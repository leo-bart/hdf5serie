CMAKE_MINIMUM_REQUIRED (VERSION 2.8.12)

PROJECT(hdf5serie)

### The version number
SET (hdf5serie_MAJOR_VERSION 2)
SET (hdf5serie_MINOR_VERSION 0)
SET (hdf5serie_PATCH_VERSION 0)
set(hdf5serie_VERSION ${hdf5serie_MAJOR_VERSION}.${hdf5serie_MINOR_VERSION}.${hdf5serie_PATCH_VERSION})

#############################################
### Options #################################
#############################################

#############################################
### Search for dependencies #################
#############################################
### Use PkgConfig for searching
include(FindPkgConfig) 

### search for hdf5 --> it is buggy obviously. For now using the solutio of http://t3hmikez0r.com/2014/07/11/cmake-and-hdf5-revisited/
# back up any user-defined HDF5_DIR setting
set(_SAVED_HDF5_DIR ${HDF5_DIR})
FIND_PACKAGE(HDF5 "1.8.5" NO_MODULE) # First look for hdf5-config.cmake in defined locations. This file is generated by HDF5 team and is likely more up to date than FindHDF5.cmake included in CMake.
IF(NOT HDF5_FOUND)
 # didn't find hdf5-config.cmake. Need to fall back on CMake's built-in FindHDF5.cmake logic.
 # required says we fail if it isn't found.
 # Restore the value reset by the previous call to 'find_package(HDF5 "1.8.5" NO_MODULE)'
 set(HDF5_DIR ${_SAVED_HDF5_DIR} CACHE PATH "HDF5 install dir" FORCE)
 FIND_PACKAGE(HDF5 "1.8.5" REQUIRED)
 include_directories(${HDF5_INCLUDE_DIR})
ENDIF()

#set(LIBS "-lhdf5 -lrt -lz")

### Search for fmatvec
pkg_check_modules(FMATVEC REQUIRED fmatvec>=2.0.0)
include_directories(${FMATVEC_INCLUDE_DIRS})
string (REPLACE ";" " " FMATVEC_CFLAGS_STR "${FMATVEC_CFLAGS}")

set(CMAKE_CPP_FLAGS "${CMAKE_CPP_FLAGS} -Wall -Werror -pedantic-errors -Wno-long-long")
set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -std=iso9899:1990")
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++98")

#############################################
### Include the subdirectories ##############
#############################################
add_subdirectory(hdf5serie)

#############################################
###  Installing #############################
#############################################
###  Install the pkg-config file
configure_file("hdf5serie.pc.in" "hdf5serie.pc" @ONLY)
install(FILES       "${CMAKE_CURRENT_BINARY_DIR}/hdf5serie.pc"
        DESTINATION "${CMAKE_INSTALL_PREFIX}/lib/pkgconfig")
